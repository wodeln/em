{x2;include:header}<body>{x2;include:nav}<div class="container-fluid">	<div class="row-fluid">		<div class="main">			<div class="col-xs-2" style="padding-top:10px;margin-bottom:0px;">				{x2;include:menu}			</div>			<div class="col-xs-10" id="datacontent">				<div class="box">						<ol class="breadcrumb">							<li><a href="index.php?{x2;$_app}-master">{x2;$apps[$_app]['appname']}</a></li>							<li><a href="index.php?{x2;$_app}-master-sound-custom">自定义声音列表</a></li>							<li class="active">添加自定义呼吸音</li>						</ol>				</div>				<div class="box bottom-border pad">					<div>自定义呼吸音病例</div>				</div>				<div class="box itembox">					<form action="index.php?sound-master-sound-lungedit" method="post" class="form-horizontal">						<div class="form-group">							<label for="case" class="control-label col-lg-1">病例名称</label>							<div class="col-sm-4">								<input class="form-control" name="args[case_name]" id="case" size="25" type="text" value="{x2;$case['case_name']}" needle="needle" datatype="usertruename" max="40" alt="请输入病例名称"  msg="您必须输入病例名称"/>							</div>						</div>						<div class="form-group">							<label for="sound_file" class="control-label col-lg-1">声音文件</label>							<div class="col-sm-7">								<script type="text/template" id="pe-template-course_files">									<div class="qq-uploader-selector" qq-drop-area-text="可将图片拖拽至此处上传" style="clear:both;">										<ul class="qq-upload-list-selector list-unstyled pull-left" aria-live="polite" aria-relevant="additions removals">											<li class="text-center">												<input size="33" class="form-control qq-edit-filename-selector" type="text" name="args[sound_name]" tabindex="0" value="{x2;$case['sound_name']}">											</li>										</ul>										<ul class="qq-upload-list-selector list-unstyled pull-left" aria-live="polite" aria-relevant="additions removals">											<li class="text-center">												<input size="33" class="form-control qq-edit-filename-selector" type="text" name="args[sound_name]" tabindex="0" value="{x2;$case['sound_name']}">											</li>										</ul>										<div class="qq-upload-button-selector col-xs-3" style="padding-left: 0;">											<button class="btn btn-primary">上传文件<span class="process"></span></button>										</div>									</div>								</script>								<div class="fineuploader" attr-type="files" attr-template="pe-template-course_files" attr-ftype="wav"></div>							</div>							<input type="hidden" id="sound_file" name="args[sound_file]" value="{x2;$case['sound_file']}">						</div>						<div class="form-group">							<label for="modules" class="control-label col-lg-1">设置分类</label>							<div class="col-sm-4">								<select id="modules" class="form-control combox" name="args[case_type]" needle="needle" msg="您必须选择一个分类">									<option value="">请选择分类</option>									<option {x2;if:$case['case_type']==0}selected{x2;endif} value="0">儿童</option>									<option {x2;if:$case['case_type']==1}selected{x2;endif} value="1">成人</option>									<option {x2;if:$case['case_type']==2}selected{x2;endif} value="2">老人</option>								</select>							</div>						</div>                        <div class="form-group bottom-border">                        </div>                        <div class="form-group">                            <div class="pull-left lung_left">                                <div class="voice"><span class="lung_position">听诊部位</span><span class="lung_positions">听诊区</span></div>                                <ul class="voice">                                    <li>										<span class="lung_position"><input onchange="ifShow(this)" sid="0" id="lungpositions0" type="checkbox" name="args[position]" value="26">支气管听诊区</span>										<span class="lung_positions">26</span><span class="setting"><a data-toggle="modal" data-id="0" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[0]['lungposition']}" name="lungposition[]" id="lung0" >                                        <input type="hidden" value="{x2;$casePosition[0]['lungvolume']}" name="lungvolume[]" id="lungvolume0" >										<input type="hidden" value="0" name="sid[]" id="sid0">									</li>                                    <li>										<span class="lung_position"><input onchange="ifShow(this)" sid="1" id="lungpositions1" type="checkbox" name="args[position]" value="24,25,27,28,29,30,31">左肺上叶听诊区</span>										<span class="lung_positions">24,25,27,28…</span><span class="setting"><a data-toggle="modal" data-id="1" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[1]['lungposition']}" name="lungposition[]" id="lung1" >                                        <input type="hidden" value="{x2;$casePosition[1]['lungvolume']}" name="lungvolume[]" id="lungvolume1" >										<input type="hidden" value="1" name="sid[]" id="sid1">									</li>                                    <li>										<span class="lung_position"><input onchange="ifShow(this)" sid="2" type="checkbox" id="lungpositions2" name="args[position]" value="32,33">左肺下叶听诊区</span>										<span class="lung_positions">32,33</span><span class="setting"><a data-toggle="modal" data-id="2" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[2]['lungposition']}" name="lungposition[]" id="lung2" >                                        <input type="hidden" value="{x2;$casePosition[2]['lungvolume']}" name="lungvolume[]" id="lungvolume2" >										<input type="hidden" value="2" name="sid[]" id="sid2">                                    </li>                                    <li>										<span class="lung_position"><input onchange="ifShow(this)" sid="3" id="lungpositions3" type="checkbox" name="args[position]" value="17,18,19,22,23">右肺上叶听诊区</span>										<span class="lung_positions">17,18,19,22…</span><span class="setting"><a data-toggle="modal" data-id="3" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[3]['lungposition']}" name="lungposition[]" id="lung3" >                                        <input type="hidden" value="{x2;$casePosition[3]['lungvolume']}" name="lungvolume[]" id="lungvolume3" >										<input type="hidden" value="3" name="sid[]" id="sid3">									</li>                                    <li>										<span class="lung_position"><input onchange="ifShow(this)" sid="4" id="lungpositions4" type="checkbox" name="args[position]" value="20,21,51">右肺中叶听诊区</span>										<span class="lung_positions">20,21,51</span><span class="setting"><a data-toggle="modal" data-id="4" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[4]['lungposition']}" name="lungposition[]" id="lung4" >                                        <input type="hidden" value="{x2;$casePosition[4]['lungvolume']}" name="lungvolume[]" id="lungvolume4" >										<input type="hidden" value="4" name="sid[]" id="sid4">									</li>									<li>										<span class="lung_position"><input onchange="ifShow(this)" sid="5" id="lungpositions5" type="checkbox" name="args[position]" value="48,50">右肺下叶听诊区</span>										<span class="lung_positions">48,50</span><span class="setting"><a data-toggle="modal" data-id="5" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[5]['lungposition']}" name="lungposition[]" id="lung5" >                                        <input type="hidden" value="{x2;$casePosition[5]['lungvolume']}" name="lungvolume[]" id="lungvolume5" >										<input type="hidden" value="5" name="sid[]" id="sid5">									</li>									<li>										<span class="lung_position"><input onchange="ifShow(this)" sid="6" id="lungpositions6" type="checkbox" name="args[position]" value="26,35,36,42">肩胛上区</span>										<span class="lung_positions">26,35,36,42</span><span class="setting"><a data-toggle="modal" data-id="6" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[6]['lungposition']}" name="lungposition[]" id="lung6" >                                        <input type="hidden" value="{x2;$casePosition[6]['lungvolume']}" name="lungvolume[]" id="lungvolume6" >										<input type="hidden" value="6" name="sid[]" id="sid6">									</li>									<li>										<span class="lung_position"><input onchange="ifShow(this)" sid="7" id="lungpositions7" type="checkbox" name="args[position]" value="37,38,43,44">肩胛间区</span>										<span class="lung_positions">37,38,43,44</span><span class="setting"><a data-toggle="modal" data-id="7" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[7]['lungposition']}" name="lungposition[]" id="lung7" >                                        <input type="hidden" value="{x2;$casePosition[7]['lungvolume']}" name="lungvolume[]" id="lungvolume7" >										<input type="hidden" value="7" name="sid[]" id="sid7">									</li>									<li>										<span class="lung_position"><input onchange="ifShow(this)" sid="8" id="lungpositions8" type="checkbox" name="args[position]" value="34,39,40,41,45,46,47,49">肩胛下区</span>										<span class="lung_positions">34,39,40,41…</span><span class="setting"><a data-toggle="modal" data-id="8" data-target="#moreSetting">高级设置</a></span>                                        <input type="hidden" value="{x2;$casePosition[8]['lungposition']}" name="lungposition[]" id="lung8" >                                        <input type="hidden" value="{x2;$casePosition[8]['lungvolume']}" name="lungvolume[]" id="lungvolume8" >										<input type="hidden" value="8" name="sid[]" id="sid8">									</li>                                </ul>                            </div>                            <div class="lung_bak_img pull-left">								<img src="/app/core/styles/img/point_img" class="lungPoint7">								<img src="/app/core/styles/img/point_img" class="lungPoint8">								<img src="/app/core/styles/img/point_img" class="lungPoint9">								<img src="/app/core/styles/img/point_img" class="lungPoint10">								<img src="/app/core/styles/img/point_img" class="lungPoint12">								<img src="/app/core/styles/img/point_img" class="lungPoint13">								<img src="/app/core/styles/img/point_img" class="lungPoint14">								<img src="/app/core/styles/img/point_img" class="lungPoint15">								<img src="/app/core/styles/img/point_img" class="lungPoint17">								<img src="/app/core/styles/img/point_img" class="lungPoint18">								<img src="/app/core/styles/img/point_img" class="lungPoint19">								<img src="/app/core/styles/img/point_img" class="lungPoint20">								<img src="/app/core/styles/img/point_img" class="lungPoint21">								<img src="/app/core/styles/img/point_img" class="lungPoint22">								<img src="/app/core/styles/img/point_img" class="lungPoint23">								<img src="/app/core/styles/img/point_img" class="lungPoint24">								<img src="/app/core/styles/img/point_img" class="lungPoint25">								<img src="/app/core/styles/img/point_img" class="lungPoint26">								<img src="/app/core/styles/img/point_img" class="lungPoint27">								<img src="/app/core/styles/img/point_img" class="lungPoint28">								<img src="/app/core/styles/img/point_img" class="lungPoint29">								<img src="/app/core/styles/img/point_img" class="lungPoint30">								<img src="/app/core/styles/img/point_img" class="lungPoint31">								<img src="/app/core/styles/img/point_img" class="lungPoint32">								<img src="/app/core/styles/img/point_img" class="lungPoint33">								<img src="/app/core/styles/img/point_img" class="lungPoint34">								<img src="/app/core/styles/img/point_img" class="lungPoint35">								<img src="/app/core/styles/img/point_img" class="lungPoint36">								<img src="/app/core/styles/img/point_img" class="lungPoint37">								<img src="/app/core/styles/img/point_img" class="lungPoint38">								<img src="/app/core/styles/img/point_img" class="lungPoint39">								<img src="/app/core/styles/img/point_img" class="lungPoint40">								<img src="/app/core/styles/img/point_img" class="lungPoint41">								<img src="/app/core/styles/img/point_img" class="lungPoint42">								<img src="/app/core/styles/img/point_img" class="lungPoint43">								<img src="/app/core/styles/img/point_img" class="lungPoint44">								<img src="/app/core/styles/img/point_img" class="lungPoint45">								<img src="/app/core/styles/img/point_img" class="lungPoint46">								<img src="/app/core/styles/img/point_img" class="lungPoint47">								<img src="/app/core/styles/img/point_img" class="lungPoint48">								<img src="/app/core/styles/img/point_img" class="lungPoint49">								<img src="/app/core/styles/img/point_img" class="lungPoint50">								<img src="/app/core/styles/img/point_img" class="lungPoint51">							</div>                        </div>						<div class="form-group bottom-border"></div>						<div class="form-group">							<div class="col-sm-1">								<button class="btn btn-primary" type="submit">提交</button>								<input type="hidden" name="modifyLung" value="1"/>								<input type="hidden" name="page" value="{x2;$page}"/>								<input type="hidden" name="case_id" value="{x2;$case['case_id']}"								{x2;tree:$search,arg,aid}								<input type="hidden" name="search[{x2;v:key}]" value="{x2;v:arg}"/>								{x2;endtree}							</div>						</div>					</form>				</div>			</div>		</div>	</div></div><div id="moreSetting" class="modal fade">	<div class="modal-dialog" id="lung_dialog">		<div class="modal-content">			<div class="modal-header">				<button aria-hidden="true" class="close" type="button" data-dismiss="modal">×</button>				<h4 id="myModalLabel">					高级设置				</h4>			</div>			<div class="modal-body" id="lung">				<ul id="lung_modal" class="pull-left">				</ul>				<div id="lung_modal_bak_img" class="pull-left">					<img src="/app/core/styles/img/point_img" class="lungPointModal17 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal18 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal19 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal20 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal21 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal22 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal23 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal24 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal25 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal26 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal27 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal28 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal29 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal30 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal31 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal32 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal33 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal34 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal35 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal36 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal37 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal38 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal39 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal40 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal41 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal42 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal43 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal44 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal45 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal46 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal47 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal48 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal49 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal50 modalImg">					<img src="/app/core/styles/img/point_img" class="lungPointModal51 modalImg">				</div>			</div>			<div class="modal-footer">                <button id="save" aria-hidden="true" class="btn btn-primary" data-dismiss="modal">确定</button>                <button  aria-hidden="true" class="btn btn-primary" data-dismiss="modal">关闭</button>			</div>		</div>	</div></div>{x2;include:footer}</body><script type="text/javascript">    var modal = $("#moreSetting");    //全局sid    var sidmodal = "";    modal.on("show.bs.modal", function(e) {        // 这里的btn就是触发元素，即你点击的删除按钮		$(".modalImg").hide();        var btn = $(e.relatedTarget),            id = btn.data("id");        sidmodal=id;        var lungPositionsKey="lungpositions"+id;        var ids = $("#"+lungPositionsKey).val();        var strs= new Array(ids.split(",").length);        var temp=[];        temp=ids.split(",");        //一维数组转为二维数组		for(var i=0;i<temp.length;i++){		    strs[i]=[];            strs[i]['check']="";            strs[i]['volume']="";            strs[i]['value'] =temp[i];		}		var LPKey = "lung"+id;        var LVKey = "lungvolume"+id;        var LPStr = $("#"+LPKey).val();        var htmlStr="<li class='lung_model_position'><span class='modal_position'>听诊区</span><span class='modal_volume'>音量(%)</span></li>";        //设置之前选中项的选中状态和播放声音        if(LPStr.length>0){			var LPArr = LPStr.split(",");			var LVArr = $("#"+LVKey).val().split(",");            for (var i=0;i<strs.length ;i++ ) {				for (var n=0;n<LPArr.length; n++){					if(strs[i]['value']==LPArr[n]){                        strs[i]['check']="checked";                        strs[i]['volume']=LVArr[n];                        continue;					}				}			}		}		//组合html		for (var i=0;i<strs.length ;i++ ) {			htmlStr+="<li class='lung_model_position'><span class='modal_position'> <input onchange='ifShowModal(this)' class='mp"+id+"' "+strs[i]['check']+" type='checkbox' value='"+strs[i]['value']+"'>"+strs[i]['value']+"</span><span class='modal_volume'><input type='text' id='modal_volume"+strs[i]['value']+"' name='args[volume]' value='"+strs[i]['volume']+"'></span>";            var modalPoint = "lungPointModal" + strs[i]['value'];			if(strs[i]['check']!=""){				$("."+modalPoint).show();			}        }        $("#lung_modal").html(htmlStr);    })    $("#save").click(function () {        //循环确定 听诊部位单一位置是否选中，选中设置相应声音播放音量，不填为100        var positionStr=[];        var volumes = [];		var mpKey = "mp"+sidmodal;		$("."+mpKey).each(function(){			if($(this).get(0).checked){                positionStr[positionStr.length]=$(this).val();                var volumeKey = "modal_volume"+$(this).val();                var volumeValue = $("#"+volumeKey).val();                if(volumeValue=="")volumes[volumes.length]=100;                else volumes[volumes.length]=volumeValue;			}		});        var lpKey = "lungpositions"+sidmodal;        var lKey = "lung"+sidmodal;        var llKey = "lungvolume"+sidmodal;        //选中一部分时复选框样式        if(positionStr.length>0 && positionStr.toString().length< $("#"+lpKey).val().length){            $("#"+lpKey).attr("class","lung_sect_select");            $("#"+lpKey).prop("checked",false);            $("#"+lKey).attr("disabled",false);            $("#"+llKey).attr("disabled",false);        }else if(positionStr.toString().length == $("#"+lpKey).val().length){            $("#"+lpKey).attr("class","");            $("#"+lpKey).prop("checked",true);            $("#"+lKey).attr("disabled",false);            $("#"+llKey).attr("disabled",false);        }else{            $("#"+lpKey).attr("class","");            $("#"+lpKey).prop("checked",false);            $("#"+lKey).attr("disabled",true);            $("#"+llKey).attr("disabled",true);		}        var lKey = "lung"+sidmodal;        var lvKey = "lungvolume" + sidmodal;        $("#"+lKey).val(positionStr.toString());        $("#"+lvKey).val(volumes.toString());    });	$(function () {        $("input[name='args[position]']").each(function(){			var lung = 'lung' + $(this).attr("sid");			var lpKey = "lungpositions"+$(this).attr("sid");            var lKey = "lung"+$(this).attr("sid");            var llKey = "lungvolume"+$(this).attr("sid");            var sidKey = "sid" +$(this).attr("sid");			if($("#"+lung).val().length>0 && $(this).val().length > $("#"+lung).val().length){                $("#"+lpKey).attr("class","lung_sect_select");                var strs = $("#"+lung).val().split(",");                for (i = 0; i < strs.length; i++) {                    var point = 'lungPoint' + strs[i];                    $("."+point).css("display","block");                }			}else if($(this).val().length == $("#"+lung).val().length){                $("#"+lpKey).attr("class","");                $("#"+lpKey).prop("checked",true);                var strs = $("#"+lung).val().split(",");                for (i = 0; i < strs.length; i++) {                    var point = 'lungPoint' + strs[i];                    $("."+point).css("display","block");                }			}else{                $("#"+lpKey).attr("class","");                $("#"+lpKey).prop("checked",false);                $("#"+lKey).attr("disabled",true);                $("#"+llKey).attr("disabled",true);                $("#"+sidKey).attr("disabled",true);			}		});    });    function ifShowModal(obj) {        var point = 'lungPoint' + $(obj).val();        var modalPoint = "lungPointModal" + $(obj).val();        var volume = "modal_volume" + $(obj).val();        if($(obj).get(0).checked) {            $("."+point).show();            $("."+modalPoint).show();            $("#"+volume).attr("disabled",false);            $("#"+volume).val("100");		}else {            $("."+point).hide();            $("."+modalPoint).hide();            $("#"+volume).attr("disabled",true);            $("#"+volume).val("");		}    }    function removeByValue(arr, val) {        for(var i=0; i<arr.length; i++) {            if(arr[i] == val) {                arr.splice(i, 1);                break;            }        }    }	function ifShow(obj) {        var lpKey = "lungpositions" + $(obj).attr("sid");        var lKey = "lung"+ $(obj).attr("sid");        var llKey = "lungvolume"+ $(obj).attr("sid");        $("#"+lpKey).attr("class","");		var id=$(obj).val();        var strs= new Array();        if(id.length>1){            strs=id.split(",");        }else {            strs[0]=id;        }        var posistionSelectKey =  "lung"+$(obj).attr("sid");        var volumeKey = "lungvolume"+$(obj).attr("sid");        if($(obj).get(0).checked) {            var volume=new Array();            for (i = 0; i < strs.length; i++) {                var point = 'lungPoint' + strs[i];                $("."+point).css("display","block");                volume[i] = 100;            }            $("#"+posistionSelectKey).val(id);            $("#"+volumeKey).val(volume.toString());            $("#"+lKey).attr("disabled",false);            $("#"+llKey).attr("disabled",false);        }else {            for (i = 0; i < strs.length; i++) {                var point = 'lungPoint' + strs[i];                $("."+point).css("display","none");            }            $("#"+posistionSelectKey).val("");            $("#"+volumeKey).val("");            $("#"+lKey).attr("disabled",true);            $("#"+llKey).attr("disabled",true);		}    }</script></html>